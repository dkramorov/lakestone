var toggleMMenu=function(b){$("#categories2m").toggle()};var toggleSMenu=function(d){var c;if($(d).hasClass("item")){c=$(d)}else{c=$(d).parents(".item")}var b=c.next();if(!b.hasClass("sub_cat")){console.error("unexpected item: ",b);console.error("target: ",d);return}c.find(".operate svg").toggle();b.toggle()};var menu_watch=function(b){var c=function(){$(".cat_ext").fadeOut(100);$("#categories2 .menu .item").removeClass("active");$(document).off("mousemove",menu_watch);$("#categories2").removeClass("ext-opened")};if($(b.target).parents("#categories2").length==0){c()}else{}};var loadRMap=function(b){if(typeof RMap!=="object"){if(typeof b==="function"){window.RMapInit=function(){b()}}$.getScript("catalog/view/javascript/locality.min.js")}else{if(typeof b==="function"){b()}}};var SetupSimpleBar=function(b){checkStartUp(["SimpleBar"],function(){var c=new SimpleBar(b,{autoHide:false})})};var dropdown_locality=function(){var c=jQuery211;var b=c("#input_locality").val();let $URL=c('<a href="'+location.href+'"></a>');c("#SelectLocality .dropdown-menu").remove();if(b.length==0){return}c.post("/index.php?route=common/locality/search",{name:b},function(g){var f=c("#input_locality").parent();if(Object.keys(g.result).length>0){var e=c('<ul class="dropdown-menu" aria-labelledby="input_locality"></ul>');Object.keys(g.result).forEach(function(i){let cur=g.result[i];var h=new RegExp(b,"i");var j=i.replace(h,'<span class="selected">$&</span>');var d=c('<a data-locality="'+i+'">'+j+"</a>");if(typeof cur.SubDomain!=="undefined"&&cur.SubDomain.length>3){$URL[0].hostname=cur.SubDomain;d.attr("href",$URL[0])}else{d.attr("role","button");d.attr("onclick","setRemoteLocality(this)");d.attr("data-sub_domain",cur.RemoteDomain);$URL[0].hostname=cur.RemoteDomain;d.attr("href",$URL[0])}e.append(c("<li></li>").append(d))});c("#input_locality").after(e);if(!f.hasClass("open")){f.addClass("open")}}else{f.removeClass("open")}})};const setRemoteLocality=function(b){window.event.preventDefault();let a=$("#SelectLocality .content");let rd=$(b).attr("data-sub_domain");let loc=$(b).attr("data-locality");let url=$(b).attr("href");onSpinner(a);$.ajax({url:"//"+rd+"/index.php?route=common/locality/setRemoteLocality&loc="+loc,xhrFields:{withCredentials:true},success:function(c){location=url}});return false};var setLocality=function(d){var c=jQuery211;onSpinner(b);var b=(typeof d==="undefined"?c("#input_locality").val():d);if(b){c.get("/index.php?route=common/locality/setLocality",{name:b},function(){setup_delivery(b);DPoint="";c("#input_locality").trigger("change_locality",[b])})}};const select_locality=function(f){var e=jQuery211;var g=e(f).attr("data-sub_domain");var c=e(f).text();onSpinner(f);if(g){var b=location.href.split("/");location.href=b[0]+"//"+g+"/"+b[3];return}e(".dropdown-menu").parent().removeClass("open");e.get("/index.php?route=common/locality/setLocality",{name:c},function(){setup_delivery(c);DPoint="";e("#input_locality").trigger("change_locality",[c])})};var setup_delivery=function(b){$("#SelectLocality .city").text(b);window.Locality=b;$("#SelectLocality").modal("hide");$("#menu2m .delivery-setup").load("/index.php?route=common/locality/getSetupDeliveryM");$("#up-nav2 .delivery-setup").load("/index.php?route=common/locality/getSetupDelivery",function(){offSpinner($("#SelectLocality .content"))})};var setup_order_placing=function(){var j=jQuery211;var e=j(window).width();var d=j("#order_placing");var c=0.9;if(e<=767){c=0.98}var g=j(window).innerHeight()*c;d.find(".modal-dialog").width(e*c).css("top",20);d.find(".modal-content").height(g);var f=d.find(".modal-header").outerHeight();var i=d.find(".modal-body .title").outerHeight();if(f==0){f=51}if(i==0){i=23}var k=g-f-30;if(e<=767){d.find(".modal-body .addresses").height(k*0.4-i);d.find(".map-canvas").height(k*0.6)}else{d.find(".modal-body .addresses").height(k-i);d.find(".map-canvas").height(k);d.find("svg.spinner").css("top",k/2)}};var presetup_modal_window=function(){var b=$(this).attr("id");switch(b){case"order_placing":break}};var setupModalPosition=function(b){var g=40;var c=$(window).height()-g;var e=$(".modal-dialog",b);var d=e.outerHeight();var f=(c-d)/2;if(c<d){f=0}e.css("top",f+"px")};var setup_modal_window=function(){var b=$(this).attr("id");switch(b){case"SelectLocality":$("#input_locality").focus().val("");break;case"order_placing":setup_order_placing();loadRMap(OP_Init);break}};var reset_modal_window=function(){$(".modal-dialog",this).removeAttr("style")};var setPoint=function(b){DPoint=$(b).attr("data-provider")+"."+$(b).attr("data-id");var d=$(b).parents(".pickpoint_info").find(".address").text();var c={dpoint:DPoint,addr:d};$.getJSON("index.php?route=common/locality/setPlace",c);$("#order_placing").trigger("setPoint",c);$(b).prop("disabled",true).text("выбран")};var messageMap=function(f,d){var e=d.dom;var b=$(e).parents(".map-canvas");var c=b.find(".cover");$(e).css("opacity",0.2);c.addClass("error");c.find(".spinner").css("display","none");c.css("display","block");c.find(".message").text(f)};var OP_Init=function(){var d=window;var c=$("#order_placing");if(typeof d.OPMap==="undefined"){d.OPMap=RMap.initMap(c.find(".map"));d.OPMap.Locality=d.Locality}else{if(d.OPMap.Locality==d.Locality){return}}c.find(".modal-header .city").text(d.Locality);OPMap.callback={infowindow_content:function(f){var e;if(DPoint===f.Provider+"."+f.ID){e='<button data-provider="'+f.Provider+'" data-id="'+f.ID+'" onClick="setPoint(this)" disabled="yes" class="btn btn-primary setPlace">Выбран</button>'}else{e='<button data-provider="'+f.Provider+'" data-id="'+f.ID+'" onClick="setPoint(this)" class="btn btn-primary setPlace">Выбрать этот пункт</button>'}return'<div class="pickpoint_info"><strong class="address">'+f.address+'</strong><p class="gmap_infowindow_guide">'+f.guide+'</p><div class="text-center">'+e+"</div></div>"},unblockMap:function(){var g=OPMap.dom;var e=$(g).parents(".map-canvas");var f=e.find(".cover");if(OPMap.ds){OPMap.ds.click();OPMap.ds=false}else{OPMap.ds=true}$(g).css("opacity",1);f.css("display","none")},errorMap:function(){messageMap("Не удалось загрузить карты",OPMap);delete OPMap}};var b=c.find(".modal-body .addresses");b.empty();$.getJSON("index.php?route=common/locality/getPlaces&locality="+d.Locality,function(e){if(typeof e.places==="undefined"||!e.places){messageMap("К сожалению, в этом населенном пункте нет точек выдачи заказа",OPMap);b.load("index.php?route=common/locality/getEmptyPickPoint");return}RMap.setBounds(OPMap,e.bounds);RMap.setPlaces(OPMap,e.places);e.places.forEach(function(f){var g=$('<div class="item" data-pickpoint_id="'+f.Provider+"."+f.ID+'"><a>'+f.address+"</a></div>");g.on("click",function(){f.marker.click()});b.append(g)});if(typeof DPoint!=="undefined"){if(typeof $ds==="undefined"){$ds=b.find('div[data-pickpoint_id="'+DPoint+'"]');if($ds.length>0){if(OPMap.ds){$ds.click()}else{OPMap.ds=$ds}}}}}).fail(function(f){ErrorLog("error ajax: ",f)})};var showQuickview=function(c){var e=$(".modal.ajax");var d=$(".modal-content",e);var f=$(".ajax-content",d);onSpinner(f);var g=$(window).width();var b=$(window).height();var h=g*0.6;if(g<900){h=g*0.9}if(!e.hasClass("in")){e.find(".modal-dialog").width(h).css("margin","auto");d.height(b*0.8);e.modal("show")}$.post("/index.php?route=product/product/quickview",{product_id:c},function(i){f.empty().append(i);d.css("height","");offSpinner(f)})};var closeVideo=function(){var b=$(".modal.default");$(".modal-content .content",b).empty();b.off("hidden.bs.modal",window.closeVideo)};var showVideo=function(j,k){k=(typeof k==="undefined"?"youtube":k);var i=$(".modal.default");var b=$(".modal-content",i);var g=$(".content",b);var e=$(window).width();var c=$(window).height()-40;var l,f;if(e>c){f=c*0.8;l=f*1.77;if(l>e*0.8){l=e*0.8;f=l*0.56}}else{l=e*0.8;f=l*0.56}if(!i.hasClass("in")){i.find(".modal-dialog").width(l).css("margin","auto");i.modal("show")}var h=$('<div style="margin-top:38px"><div class="media"><iframe src="https://www.youtube.com/embed/'+j+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>');g.empty().append(h);i.on("hidden.bs.modal",window.closeVideo);offSpinner(g)};var LazyLoadObject=function(c,b){if(typeof IntersectionObserver==="undefined"){b.call({target:c});return}var d=$(c).get()[0];if(typeof this.funcs==="undefined"){this.funcs=[]}this.funcs.push({target:d,func:b});this.obj_load=function(e){e.forEach(function(f){if(!f.isIntersecting){return}funcs.forEach(function(h,g){if(h.target==f.target){h.func();observer.unobserve(f.target);delete funcs[g]}})})};this.config={};if(typeof this.observer==="undefined"){this.observer=new IntersectionObserver(obj_load,config)}this.observer.observe(d)};var onSpinner=function(c,b){b=(typeof b==="undefined"?5000:b);$(c).parents(".canvas").find(".wait-spinner").removeClass("hidden");if(typeof window.timeoutSpinner!=="undefined"){clearTimeout(window.timeoutSpinner)}window.timeoutSpinner=setTimeout(function(){offSpinner(c)},b)};var offSpinner=function(b){$(b).parents(".canvas").find(".wait-spinner").addClass("hidden");if(typeof window.timeoutSpinner!=="undefined"){clearTimeout(window.timeoutSpinner)}};const showErrorMessage=function(b,c){let text=b;let $M=$("#error-message");if(b instanceof Error){text=b.message}c=typeof c==="undefined"?"Сообщение об ошибке":c;$(".modal-header .title",$M).text(c);$(".modal-body .text",$M).html(text);$M.modal("show")};